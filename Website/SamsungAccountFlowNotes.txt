Samsung Account / ChatON WinRT flow notes\r\n\r\n1. Endpoints the WinRT client calls\r\n- https://account.samsung.com/mobile/account/check.do?serviceID=...&actionID=StartOAuth2&countryCode=...&languageCode=...&returnType=url\r\n- https://auth.samsungosp.com/auth/oauth2/token?grant_type=authorization_code&code=...&client_id=p62020g0mz&client_secret=D5CABF6A10CB9F63C030E48EB7C7A8E0\r\n- http://api.samsungosp.net/v2/profile/user/user/{UserID}\r\n\r\n2. Sign-in / sign-up flow in SamsungAccountSigninDialog\r\n- Shows a WebView pointing to GetSignInUrl() (account.samsung.com/mobile/account/check.do with StartOAuth2).\r\n- When WebView navigates to a URL containing "code" in the query string, it parses the query params into a dictionary.\r\n- If error_code is present, it shows an error and stops.\r\n- Otherwise it calls SamsungAccountService.GetAccessToken(code).\r\n- On SUCCESS it calls SamsungAccountService.GetUserEmail(), then:\r\n  - If RegistrationService.ChatOnID is empty, navigates to InputNamePage with mode=SamsungAccount, passing the access token and email (ChatON sign-up).\r\n  - If ChatOnID is not empty, it starts device mapping and sync (existing ChatON user).\r\n- Any exception in this code path triggers HandleNetworkErrorRetryLogin(), which restarts the WebView on the sign-in URL and shows the "please wait" loading indicator again.\r\n\r\n3. GetAccessToken() behavior\r\n- Uses HttpWebRequest POST to https://auth.samsungosp.com/auth/oauth2/token with query params grant_type, code, client_id, client_secret.\r\n- Expects a JSON body that deserializes into SerializerData.AccessTokenRePonseData with fields:\r\n  - userId\r\n  - access_token\r\n- On success it sets SamsungAccountService.UserID and AccessToken and returns SamsungAccountServiceResult with ResultType = SUCCESS.\r\n- Only WebException is caught; any other exception (e.g. malformed JSON with HTTP 200) will bubble up and be treated by the caller as a network error, which loops the "please wait" flow.\r\n\r\n4. GetUserEmail() behavior\r\n- Calls http://api.samsungosp.net/v2/profile/user/user/{UserID}.\r\n- Adds headers:\r\n  - x-osp-appId = p62020g0mz\r\n  - x-osp-userId = UserID\r\n  - Authorization = Basic <base64 of "p62020g0mz:D5CABF6A10CB9F63C030E48EB7C7A8E0">\r\n- Expects XML with at least:\r\n  - <loginID>...</loginID>\r\n  - <countryCode>...</countryCode>\r\n- Parses loginID as email and countryCode as ISO code.\r\n- If ISO code is not in SelectCountryCodePageViewModel.CodeData, it returns ResultType = NOT_ALLOWED_COUNTRY but still provides the email string.\r\n- If XML is missing or invalid and causes a non-WebException, that exception bubbles back to SamsungAccountSigninDialog and triggers the retry logic.\r\n\r\n5. "Please wait" / white screen behavior\r\n- The dialog uses LoadingIndicator.StartLoading(...) with the resource IDS_CHATON_BODY_PLEASE_WAIT_ING to show the spinner.\r\n- It shows this spinner when:\r\n  - The dialog first loads.\r\n  - HandleNetworkErrorRetryLogin() is called after navigation errors or exceptions.\r\n  - ReCancel() is called when the WebView navigates to about:blank or a URL containing close=true.\r\n- A short white screen occurs when the WebView navigates to about:blank/close=true and then is immediately navigated back to the sign-in URL by ReCancel().\r\n\r\n6. Conditions for a successful visible flow\r\n- WebView must ultimately navigate to a URL that contains "code" in the query string.\r\n- The token endpoint must return JSON with at least:\r\n  - access_token (string)\r\n  - userId (string)\r\n- The profile endpoint must return well-formed XML containing loginID and countryCode.\r\n- If those conditions are met, the WinRT app will:\r\n  - Stop the "please wait" loader for login.\r\n  - Navigate to the ChatON InputNamePage when ChatOnID is empty (new user).\r\n  - Or, for existing users, proceed with device mapping and buddy/chat sync.\r\n\r\n7. Mock endpoints added in Roblox-Webserver Website project\r\n- Controllers:\r\n  - SamsungAccountController: GET /mobile/account/check.do\r\n    - Ignores most query params and immediately redirects to /mobile/account/complete.do?code=FAKE_CODE on the same host.\r\n    - This ensures the WebView sees a URL containing code=... and enters the OAuth completion branch.\r\n  - SamsungAuthController: POST /auth/oauth2/token\r\n    - Accepts grant_type, code, client_id, client_secret from the query string.\r\n    - Returns JSON: { "access_token": "FAKE_ACCESS_TOKEN", "userId": "1234567890" }.\r\n    - Satisfies the GetAccessToken() expectations so deserialization succeeds.\r\n  - SamsungProfileController: GET /v2/profile/user/user/{userId}\r\n    - Returns XML: <profile><loginID>test-{userId}@example.com</loginID><countryCode>US</countryCode></profile>.\r\n    - Provides the loginID and countryCode elements that GetUserEmail() looks for, avoiding XML parse errors.\r\n\r\n8. How to use these mocks\r\n- Point the relevant Samsung hostnames (account.samsung.com, auth.samsungosp.com, api.samsungosp.net) to this webserver via hosts/DNS or reverse proxy.\r\n- The WinRT client will then talk to this server and see valid responses, so its WebView will display content and the sign-in/sign-up flow will complete without getting stuck on the "please wait" screen due to malformed responses.
