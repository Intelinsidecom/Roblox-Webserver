;// bundle: pushnotifications___ca0b30ce62507b2f2e2bae60c925f2c8_m
;// files: Notifications/ChromePushNotificationsRegistrar.js, Notifications/DesktopPushNotificationsRegistrationUI.js

;// Notifications/ChromePushNotificationsRegistrar.js
typeof Roblox=="undefined"&&(Roblox={}),Roblox.PushNotificationRegistrar=function(){var o="Roblox.PushNotificationRegistrar.LastRegistrationSendTimestamp",t={permissionDenied:"permissionDenied",other:"other"},n,r,u=!1,i=!1,s=function(){var t=$("#push-notification-registrar-settings");n=t.data("notificationshost"),r=t.data("reregistrationinterval")||288e5},f=function(t,i,r){var u=t.endpoint.substr(t.endpoint.lastIndexOf("/")+1);$.ajax({method:"POST",url:n+"/v1/push-notifications/register-chrome?notificationToken="+u+"&initiatedByUser="+i,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(){c(),r&&typeof r=="function"&&r()}})},e=function(){var n=Roblox.Cookies.getSessionId();return o+"_"+n},h=function(){var n=localStorage.getItem(e());if(!n)return!1;var t=+new Date(n),i=+new Date,u=i-t;return u<=r},c=function(){localStorage.setItem(e(),new Date)},l=function(){if(Roblox.ServiceWorkerRegistrar&&Roblox.ServiceWorkerRegistrar.serviceWorkersSupported()&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window){if(u=!0,s(),Notification.permission==="denied"){i=!0;return}navigator.serviceWorker.controller&&navigator.serviceWorker.ready.then(function(n){return n.pushManager.getSubscription()}).then(function(n){n&&(h()||f(n,!1))}).catch(function(){})}},a=function(n,i){Roblox.ServiceWorkerRegistrar.register(),navigator.serviceWorker.ready.then(function(r){r.pushManager.subscribe({userVisibleOnly:!0}).then(function(t){f(t,!0,n)}).catch(function(){Notification.permission==="denied"?i&&typeof i=="function"&&i(t.permissionDenied):i&&typeof i=="function"&&i(t.other)})})},v=function(t,i){$.ajax({method:"POST",url:n+"/v1/push-notifications/deregister-current-device",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){n&&n.Status&&n.Status==="success"&&t&&typeof t=="function"&&t(!0)},error:function(n){i&&typeof i=="function"&&i(n)}})},y=function(t){if(i){t(!1);return}navigator.serviceWorker.ready.then(function(n){return n.pushManager.getSubscription()}).then(function(i){if(!i){t(!1);return}$.ajax({method:"GET",url:n+"/v1/push-notifications/get-current-device-destination",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){n&&n.Destination?t(!0):t(!1)}})})};return{initialize:l,subscribe:a,unsubscribe:v,isPushSupported:function(){return u},isPushEnabled:y,isPushBlockedByUser:function(){return i},subscriptionFailureReasons:t}}(),$(Roblox.PushNotificationRegistrar.initialize);

;// Notifications/DesktopPushNotificationsRegistrationUI.js
typeof Roblox=="undefined"&&(Roblox={}),Roblox.PushNotificationRegistrationUI=function(){var s="Roblox.PushNotificationRegistrationUI.LastRegistrationPromptTimestamp",c="Roblox.PushNotificationRegistrationUI.PromptCount",h="Roblox.PushNotificationRegistrationUI.PromptActive",f="Roblox.PushNotificationRegistrationUI.PromptMessage",r=[86400,604800],it,tt,t,e=null,u=null,ot=function(){var n=$("#push-notification-registration-ui-settings");r=n.data("promptintervals"),it=n.data("notificationsdomain"),tt=n.data("userid")},n=function(n){return n+"_"+tt},i=function(){e&&(e.hide(),u.removeClass("modal-open"),$(".modal-backdrop").hide(),e=null,u=null),$("#push-notifications-registration-prompt").remove()},et=function(n){var t=$("#navContent");t.length>0?t.prepend(n):$("#wrap .container-main").prepend(n)},nt=function(n){i();var r=$("#"+n+"-template"),t=$('<div id="push-notifications-registration-prompt"></div>');t.append(r.html()),et(t)},o=function(n){i();var r=$("#"+n+"-template"),t=$('<div id="push-notifications-registration-prompt"></div>');t.append(r.html()),u=$("#rbx-body"),u.append(t),e=$("#"+n+"-modal").bootstrapModal({backdrop:"static",show:!0,keyboard:!1})},d=function(n){nt(n);var t=$("#push-notifications-registration-prompt .alert-success");Roblox.BootstrapWidgets.ToggleSystemMessage(t,100,3e3)},g=function(n,t){Roblox.PushNotificationRegistrar&&Roblox.PushNotificationRegistrar.isPushSupported()&&(!st()||t)&&($(".push-notifications-global-prompt .alert-info").length===0&&$(".alert-info").length>0||$.when(rt(),ct()).done(function(t,i){if(t||i)l(!0);else{nt("push-notifications-initial-global-prompt"),n&&$("#push-notifications-registration-prompt .push-notifications-prompt-text").text(n);var r=$("#push-notifications-registration-prompt .push-notifications-prompt-actions");r.find(".push-notifications-prompt-accept").click(w),r.find(".push-notifications-dismiss-prompt").click(y),ht(n)}}).fail(function(){}))},rt=function(){var n=$.Deferred();return Roblox.PushNotificationRegistrar.isPushEnabled(function(t){n.resolve(t)}),n},ct=function(){var n=$.Deferred();return $.ajax({method:"GET",url:it+"/notifications/v1/get-settings",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){t&&t.OptedOutReceiverDestinationTypes&&t.OptedOutReceiverDestinationTypes.indexOf("DesktopPush")!==-1?n.resolve(!0):n.resolve(!1)}}),n},k=function(){navigator.permissions.query({name:"notifications"}).then(function(n){n.onchange=function(){p()}})},a=function(){d("push-notifications-successfully-enabled"),l(!0),t&&typeof t=="function"&&t(!0)},b=function(n){n===Roblox.PushNotificationRegistrar.subscriptionFailureReasons.permissionDenied&&(k(),o("push-notifications-permissions-disabled-instruction")),t&&typeof t=="function"&&t(!1)},w=function(n){t=n,p()},ft=function(n){i(),Roblox.PushNotificationRegistrar.unsubscribe(function(){d("push-notifications-successfully-disabled"),n&&typeof n=="function"&&n()})},p=function(){i(),Notification.permission==="granted"?Roblox.PushNotificationRegistrar.subscribe(a,b):Notification.permission==="denied"?(k(),o("push-notifications-permissions-disabled-instruction")):(o("push-notifications-permissions-prompt"),Roblox.PushNotificationRegistrar.subscribe(a,b))},v=function(){var i=localStorage.getItem(n(c)),t;return i?(t=parseInt(i,10),t===NaN)?0:t:0},st=function(){var u=localStorage.getItem(n(s)),t;if(!u||(t=v(),t===0))return!1;var f=+new Date(u),e=+new Date,o=e-f,i;return i=t>r.length?r[r.length-1]:r[t-1],o<=i},ht=function(t){localStorage.setItem(n(h),!0),t?localStorage.setItem(n(f),t):localStorage.removeItem(n(f))},l=function(t){if(localStorage.setItem(n(h),!1),localStorage.removeItem(n(f)),t===!0)localStorage.removeItem(n(s)),localStorage.removeItem(n(c));else{localStorage.setItem(n(s),new Date);var i=v();localStorage.setItem(n(c),i+1)}},y=function(){i(),l(!1)},ut=function(){i()},lt=function(){ot();var t=localStorage.getItem(n(h));t&&t==="true"&&g(localStorage.getItem(n(f)),!0)};return{initialize:lt,prompt:g,decline:y,enable:w,disable:ft,closeMessage:ut}}(),$(Roblox.PushNotificationRegistrationUI.initialize);
